# Использование make

Команда make позволяет упростить сборку программы или автоматизировать какие либо действия. В качестве описания действий используются файлы Makefile. Это описание целей, которые должен выполнить make.

## Структура

Makefile состоит из целей и действий для них. Так же в Makefile допускается определять переменные для использования внутри команд. Общий синтаксис прост:
```
цель: зависимости
        команда
```
Для запуска действий выполняется команда make названием цели в качестве аргумента. Без указания аргументов make выполняет первую цель. Для целей могут быть описаны зависимости, ими могут являться другие цели или файлы. Цель может не иметь зависимостей (например, цель clean) или не иметь команд (например, цель all).

## Советы для сборки программ на C

- При сборке проекта указывайте флаги предупреждений. Есть групповые флаги (`-Wall` `-Wextra` `-Wpedantic`) gcc и clang. Для простых случаев достаточно использовать их. Описание флагов есть в списках ссылок.

- При сборке проекта указывайте флаг `-Werror` для интерпретации всех предупреждений как ошибок.

- При заглушении флагов лучше всего пользоваться `-Wno-error=...`, это скажет компилятору выдавать предупрежение на эту диагностику, но при этом не рассматривать его как ошибку. При использовании такого именования компилятор проверяет доступность такого флага. Если такого флага нет, будет выдана ошибка:
```sh
cc1: error: ‘-Wno-error=iii’: no option ‘-Wiii’
```

- В случае если диагностика ложно-положительная, допускается указывать его с префиксом `-Wno-...`. При использовании такого префикса проверка флага не выполняется.

- Указывайте используемый стандарт языка (`-std=c11`), это позволит сохранить поведение при переносе кода - разные компиляторы могут по разному интерпретировать стандарт по умолчанию

- Указывайте цель clean с перечислением всех артефактов сборки

- Указывайте .PHONY для целей, которые не являются результатом сборки. Это может помочь make не запутаться, если в директории будет файл с таким названием

## Пример

```
CC = gcc
CFLAGS = -Wall -Werror -Wpedantic -std=c99
LDFLAGS = -lm

.PHONY: all clean

all: my_app

main.o: main.c
	$(CC) $(CFLAGS) -c main.c

my_app: main.o
	$(CC) -o my_app main.o $(LDFLAGS)

clean:
	rm -rf *.o
	rm -rf libnums.a
	rm -rf my_app
```

## Полезные ссылки

- https://www.gnu.org/software/make/manual/make.html документация make
- https://makefiletutorial.com хорошее описание возможностей make
- https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html описание флагов gcc
